#include <stddef.h>
#include <stdint.h>
#include <stdio.h>

// jenkins hash, fast but insecure
uint32_t calculate_hash(uint16_t *data, size_t len) {
  uint32_t hash = 0;
  uint16_t lowest = 0;
  for (size_t i = 0; i < len; i++) {
    uint16_t lowest_high = UINT16_MAX;
    for (size_t j = 0; j < len; j++) {
      if (data[j] < lowest_high && data[j] > lowest) {
        lowest_high = data[j];
      }
    }
    lowest = lowest_high;
    printf("%i\n", lowest);
    hash += lowest;
    hash += hash << 10;
    hash ^= hash >> 6;
  }
  hash += hash << 3;
  hash ^= hash >> 11;
  hash += hash << 15;
  printf("%u\n", hash);
  return hash;
}

int main(int argc, char *argv[]) {
  // from curl ja4
  unsigned char curl[] = {
      0x13, 0x2,  0x13, 0x3,  0x13, 0x1,  0xc0, 0x2c, 0xc0, 0x30, 0x0, 0x9f,
      0xcc, 0xa9, 0xcc, 0xa8, 0xcc, 0xaa, 0xc0, 0x2b, 0xc0, 0x2f, 0x0, 0x9e,
      0xc0, 0x24, 0xc0, 0x28, 0x0,  0x6b, 0xc0, 0x23, 0xc0, 0x27, 0x0, 0x67,
      0xc0, 0xa,  0xc0, 0x14, 0x0,  0x39, 0xc0, 0x9,  0xc0, 0x13, 0x0, 0x33,
      0x0,  0x9d, 0x0,  0x9c, 0x0,  0x3d, 0x0,  0x3c, 0x0,  0x35, 0x0, 0x2f};

  unsigned char chrome[] = {0x6a, 0x6a, 0x13, 0x1,  0x13, 0x2,  0x13, 0x3,
                            0xc0, 0x2b, 0xc0, 0x2f, 0xc0, 0x2c, 0xc0, 0x30,
                            0xcc, 0xa9, 0xcc, 0xa8, 0xc0, 0x13, 0xc0, 0x14,
                            0x0,  0x9c, 0x0,  0x9d, 0x0,  0x2f, 0x0,  0x35};

  unsigned char firefox[] = {
      0x13, 0x1,  0x13, 0x3,  0x13, 0x2,  0xc0, 0x2b, 0xc0, 0x2f, 0xcc, 0xa9,
      0xcc, 0xa8, 0xc0, 0x2c, 0xc0, 0x30, 0xc0, 0xa,  0xc0, 0x9,  0xc0, 0x13,
      0xc0, 0x14, 0x0,  0x9c, 0x0,  0x9d, 0x0,  0x2f, 0x0,  0x35};

  printf("curl %u\n", calculate_hash(curl, sizeof(curl) / 2));
  printf("chrome %u\n", calculate_hash(chrome, sizeof(chrome) / 2));
  printf("firefox %u\n", calculate_hash(firefox, sizeof(firefox) / 2));
}
